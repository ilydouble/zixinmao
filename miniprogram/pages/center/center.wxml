<!--center.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å®‰å…¨åŒºå ä½ï¼Œé¿å…ä¸çŠ¶æ€æ é‡å  -->
  <view class="status-bar-spacer user-section-bg" style="height: {{statusBarHeight}}px;"></view>

  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-section">
    <view wx:if="{{isLoggedIn}}" class="user-info">
      <!-- ç”¨æˆ·å¤´åƒ -->
      <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
        <t-avatar
          size="large"
          image="{{userInfo.avatarUrl || '/images/default-avatar.png'}}"
        />
      </button>

      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="user-details">
        <view class="user-name">
          <input
            wx:if="{{!userInfo.nickName}}"
            type="nickname"
            placeholder="ç‚¹å‡»è®¾ç½®æ˜µç§°"
            bind:blur="onNicknameChange"
            class="nickname-input"
          />
          <text wx:else class="nickname-text">{{userInfo.nickName}}</text>
        </view>

        <!-- ç»„ç»‡å’ŒåŸå¸‚ä¿¡æ¯ -->
        <view class="user-location-info">
          
 
          <!-- æƒ…å†µ4ï¼šéƒ½æ²¡è®¾ç½® - æ˜¾ç¤ºå®Œæ•´è®¾ç½®æç¤º -->
          <view wx:if="{{!userInfo.organizationName &&!userInfo.cityName}}" class="no-location-info">
            <text class="info-placeholder" data-url="/pages/settings/settings" bind:tap="onNavigateToMenu">
              ç‚¹å‡»è®¾ç½®æ‰€å±ç»„ç»‡å’ŒåŸå¸‚ â†’
            </text>
          </view>
          <view wx:else>
            <text class="info-placeholder">
              <text class="tag-icon">ğŸ </text> {{userInfo.organizationName}}
              <text class="tag-icon">ğŸ“</text> {{userInfo.cityName}}
            </text>
          </view>
        </view>

        <view class="user-status">
          <text wx:if="{{userInfo.realNameVerified}}" class="verified">âœ… å·²å®åè®¤è¯</text>
          <text wx:else class="unverified">âš ï¸ æœªå®åè®¤è¯</text>
        </view>
      </view>
    </view>

    <!-- æœªç™»å½•çŠ¶æ€ -->
    <view wx:else class="login-prompt">
      <t-avatar size="large" image="/images/default-avatar.png" />
      <view class="prompt-text">
        <view class="prompt-title">æœªç™»å½•</view>
        <t-button theme="primary" size="small" bind:tap="onGetUserProfile">
          ç‚¹å‡»ç™»å½•
        </t-button>
      </view>
    </view>
  </view>

  <!-- è´¦æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view wx:if="{{isLoggedIn}}" class="account-section">
    <view class="account-card">
      <view class="account-header">
        <text class="account-title">è´¦æˆ·ä¿¡æ¯</text>
      </view>

      <view class="account-content">
        <!-- è´¦æˆ·ä½™é¢ -->
        <view class="balance-info">
          <view class="balance-item">
            <text class="balance-label">è´¦æˆ·ä½™é¢</text>
            <text class="balance-value">Â¥{{userInfo.balance || 0}}</text>
          </view>
          <view class="balance-actions">
            <t-button theme="primary" size="small" bind:tap="onRecharge">å……å€¼</t-button>
          </view>
        </view>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <view class="stats-grid">
          <view class="stats-item">
            <text class="stats-value">Â¥{{userInfo.totalRecharge || 0}}</text>
            <text class="stats-label">æ€»å……å€¼</text>
          </view>
          <view class="stats-item">
            <text class="stats-value">Â¥{{userInfo.orderStats.totalConsumption || 0}}</text>
            <text class="stats-label">æ€»æ¶ˆè´¹</text>
          </view>
          <view class="stats-item">
            <text class="stats-value">{{userInfo.orderStats.totalOrders || 0}}</text>
            <text class="stats-label">æ€»è®¢å•</text>
          </view>
          <view class="stats-item">
            <text class="stats-value">{{userInfo.orderStats.completedOrders || 0}}</text>
            <text class="stats-label">å·²å®Œæˆ</text>
          </view>
        </view>
      </view>
    </view>
  </view>



  <!-- å¸¸ç”¨åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <t-cell-group>
      <t-cell
        wx:for="{{commonMenuItems}}"
        wx:key="id"
        title="{{item.title}}"
        left-icon="{{item.icon}}"
        data-url="{{item.url}}"
        data-item="{{item}}"
        bind:click="onNavigateToMenu"
      >
        <view slot="right-icon" class="custom-arrow">â€º</view>
      </t-cell>
    </t-cell-group>
  </view>



  <!-- é€€å‡ºç™»å½• -->
  <view wx:if="{{isLoggedIn}}" class="logout-section">
    <t-button
      theme="light"
      size="large"
      block
      bind:tap="onLogout"
    >
      é€€å‡ºç™»å½•
    </t-button>
  </view>



  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="version-info">
    <view class="app-info">
      <text class="app-name">ğŸ± èµ„ä¿¡çŒ«</text>
      <text class="version">v1.0.0</text>
    </view>
    <view class="copyright">Â© 2023 èµ„ä¿¡çŒ«å›¢é˜Ÿ</view>
  </view>
</view>
