<!--center.wxml-->
<view class="container">
  <!-- 顶部安全区占位，避免与状态栏重叠 -->
  <view class="status-bar-spacer user-section-bg" style="height: {{statusBarHeight}}px;"></view>

  <!-- 用户信息区域 -->
  <view class="user-section">
    <view wx:if="{{isLoggedIn}}" class="user-info">
      <!-- 用户头像 -->
      <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
        <t-avatar
          size="large"
          image="{{userInfo.avatarUrl || '/images/default-avatar.png'}}"
        />
      </button>

      <!-- 用户信息 -->
      <view class="user-details">
        <view class="user-name">
          <input
            wx:if="{{!userInfo.nickName}}"
            type="nickname"
            placeholder="点击设置昵称"
            bind:blur="onNicknameChange"
            class="nickname-input"
          />
          <text wx:else class="nickname-text">{{userInfo.nickName}}</text>
        </view>

        <!-- 组织和城市信息 -->
        <view class="user-location-info">
          
 
          <!-- 情况4：都没设置 - 显示完整设置提示 -->
          <view wx:if="{{!userInfo.organizationName &&!userInfo.cityName}}" class="no-location-info">
            <text class="info-placeholder" data-url="/pages/settings/settings" bind:tap="onNavigateToMenu">
              点击设置所属组织和城市 →
            </text>
          </view>
          <view wx:else>
            <text class="info-placeholder">
              <text class="tag-icon">🏠</text> {{userInfo.organizationName}}
              <text class="tag-icon">📍</text> {{userInfo.cityName}}
            </text>
          </view>
        </view>

        <view class="user-status">
          <text wx:if="{{userInfo.realNameVerified}}" class="verified">✅ 已实名认证</text>
          <text wx:else class="unverified">⚠️ 未实名认证</text>
        </view>
      </view>
    </view>

    <!-- 未登录状态 -->
    <view wx:else class="login-prompt">
      <t-avatar size="large" image="/images/default-avatar.png" />
      <view class="prompt-text">
        <view class="prompt-title">未登录</view>
        <t-button theme="primary" size="small" bind:tap="onGetUserProfile">
          点击登录
        </t-button>
      </view>
    </view>
  </view>

  <!-- 会员信息卡片 -->
  <view wx:if="{{isLoggedIn}}" class="membership-section">
    <view class="membership-card" style="background: {{membershipConfig.gradient}}">
      <view class="membership-header">
        <view class="membership-badge">
          <text class="membership-icon">{{membershipConfig.icon}}</text>
          <text class="membership-name">{{membershipConfig.name}}</text>
        </view>
        <view class="membership-expiry">
          <text class="expiry-label">{{expiryStatus}}</text>
          <text class="expiry-date">{{expiryText}}</text>
        </view>
      </view>

      <view class="membership-desc">
        <text>{{membershipConfig.description}}</text>
      </view>

      <view class="membership-actions">
        <t-button
          wx:if="{{!isMembershipValid}}"
          theme="light"
          size="medium"
          bind:tap="onUpgradeMembership"
        >
          开通会员
        </t-button>
        <t-button
          wx:else
          theme="light"
          size="medium"
          bind:tap="onRenewMembership"
        >
          续费会员
        </t-button>
      </view>
    </view>

    <!-- 会员权益 -->
    <view class="membership-features">
      <view class="features-title">会员权益</view>
      <view class="features-list">
        <view
          wx:for="{{membershipConfig.features}}"
          wx:key="index"
          class="feature-item"
        >
          <text class="feature-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>



  <!-- 常用功能菜单 -->
  <view class="menu-section">
    <t-cell-group>
      <t-cell
        wx:for="{{commonMenuItems}}"
        wx:key="id"
        title="{{item.title}}"
        left-icon="{{item.icon}}"
        data-url="{{item.url}}"
        data-item="{{item}}"
        bind:click="onNavigateToMenu"
      >
        <view slot="right-icon" class="custom-arrow">›</view>
      </t-cell>
    </t-cell-group>
  </view>



  <!-- 退出登录 -->
  <view wx:if="{{isLoggedIn}}" class="logout-section">
    <t-button
      theme="light"
      size="large"
      block
      bind:tap="onLogout"
    >
      退出登录
    </t-button>
  </view>



  <!-- 版本信息 -->
  <view class="version-info">
    <view class="app-info">
      <text class="app-name">🐱 资信猫</text>
      <text class="version">v1.0.0</text>
    </view>
    <view class="copyright">© 2023 资信猫团队</view>
  </view>
</view>
